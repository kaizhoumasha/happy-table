const e=require(`./logger-DYZU5RTs.cjs`);function t(e){return String(e??``).toLowerCase()}function n(e){if(typeof e==`number`&&Number.isFinite(e))return e;if(typeof e==`string`&&e.trim()!==``){let t=Number(e);return Number.isFinite(t)?t:null}return null}function r(e){if(e instanceof Date)return e.getTime();if(typeof e==`number`&&Number.isFinite(e))return e;if(typeof e==`string`&&e.trim()!==``){let t=Date.parse(e);return Number.isFinite(t)?t:null}return null}function i(e){if(typeof e!=`string`)return null;let t=e.trim().match(/^(\d{1,2}):(\d{2})(?::(\d{2})(?:\.(\d{1,3}))?)?(?:\s*(AM|PM))?$/i);if(!t)return null;let n=parseInt(t[1],10),r=parseInt(t[2],10),i=t[3]?parseInt(t[3],10):0;if(r>=60||i>=60)return null;let a=t[5];if(a){let e=a.toUpperCase();e===`PM`&&n<12&&(n+=12),e===`AM`&&n===12&&(n=0)}return n>=24?null:n*3600+r*60+i}function a(e){if(typeof e==`number`&&Number.isFinite(e))return e;if(typeof e!=`string`)return null;let t=e.trim();if(!t)return null;let n=t.match(/^P(?=\d|T)(\d+Y)?(\d+M)?(\d+W)?(\d+D)?(T(\d+H)?(\d+M)?(\d+S)?)?$/i);if(n){let e=0,t=n[1]?parseInt(n[1],10):0,r=n[2]?parseInt(n[2],10):0,i=n[3]?parseInt(n[3],10):0,a=n[4]?parseInt(n[4],10):0,o=n[6]?parseInt(n[6],10):0,s=n[7]?parseInt(n[7],10):0,c=n[8]?parseInt(n[8],10):0;return e+=t*365*24*3600*1e3,e+=r*30*24*3600*1e3,e+=i*7*24*3600*1e3,e+=a*24*3600*1e3,e+=o*3600*1e3,e+=s*60*1e3,e+=c*1e3,e}if(/(\d+\s+(years?|months?|weeks?|days?|hours?|hrs?|minutes?|mins?|seconds?|secs?))/i.test(t)){let e=t.toLowerCase().split(/\s+/),n=0;for(let t=0;t<e.length;t++){let r=e[t];if(!r)continue;let i=parseFloat(r);if(!Number.isFinite(i))continue;let a=e[t+1];if(!a)continue;let o=a.toLowerCase();/^years?/.test(o)?n+=i*365*24*3600*1e3:/^months?/.test(o)?n+=i*30*24*3600*1e3:/^weeks?/.test(o)?n+=i*7*24*3600*1e3:/^days?/.test(o)?n+=i*24*3600*1e3:/^(hours?|hrs?)$/.test(o)?n+=i*3600*1e3:/^(minutes?|mins?)$/.test(o)?n+=i*60*1e3:/^(seconds?|secs?)$/.test(o)&&(n+=i*1e3),t+=1}return n||null}let r=t.match(/^(\d{1,3}):(\d{2})(?::(\d{2}))?$/);if(r){let e=parseInt(r[1],10),t=parseInt(r[2],10),n=r[3]?parseInt(r[3],10):0;if(t>=60||n>=60)return null;if(e>=24)return(e*3600+t*60+n)*1e3}return null}function o(e){let t=a(e),o=i(e),s=r(e),c=n(e);return{equals(l){let u=a(l);if(t!==null&&u!==null)return u===t;let d=i(l);if(o!==null&&d!==null)return d===o;let f=r(l);if(s!==null&&f!==null)return f===s;let p=n(l);return c!==null&&p!==null?p===c:l===e},notEquals(l){let u=a(l);if(t!==null&&u!==null)return u!==t;let d=i(l);if(o!==null&&d!==null)return d!==o;let f=r(l);if(s!==null&&f!==null)return f!==s;let p=n(l);return c!==null&&p!==null?p!==c:l!==e}}}function s(e){let{field:s,operator:c}=e,l=e.value;switch(c){case`equals`:{let e=o(l);return t=>e.equals(t[s])}case`notEquals`:{let e=o(l);return t=>e.notEquals(t[s])}case`contains`:{let e=t(l);return n=>t(n[s]).includes(e)}case`startsWith`:{let e=t(l);return n=>t(n[s]).startsWith(e)}case`endsWith`:{let e=t(l);return n=>t(n[s]).endsWith(e)}case`isEmpty`:return e=>e[s]===null||e[s]===void 0||String(e[s])===``;case`notEmpty`:return e=>!(e[s]===null||e[s]===void 0||String(e[s])===``);case`gt`:{let e=n(l);return t=>{let r=n(t[s]);return e!==null&&r!==null&&r>e}}case`lt`:{let e=n(l);return t=>{let r=n(t[s]);return e!==null&&r!==null&&r<e}}case`gte`:{let e=n(l),t=a(l),o=r(l),c=i(l);return l=>{let u=n(l[s]);if(e!==null&&u!==null)return u>=e;let d=a(l[s]);if(t!==null&&d!==null)return d>=t;let f=r(l[s]);if(o!==null&&f!==null)return f>=o;let p=i(l[s]);return c!==null&&p!==null&&p>=c}}case`lte`:{let e=n(l),t=a(l),o=r(l),c=i(l);return l=>{let u=n(l[s]);if(e!==null&&u!==null)return u<=e;let d=a(l[s]);if(t!==null&&d!==null)return d<=t;let f=r(l[s]);if(o!==null&&f!==null)return f<=o;let p=i(l[s]);return c!==null&&p!==null&&p<=c}}case`between`:{let[e,t]=(Array.isArray(l)?l:[])||[],o=n(e),c=n(t),u=a(e),d=a(t),f=r(e),p=r(t),m=i(e),h=i(t);return e=>{let t=n(e[s]);if(t!==null&&o!==null&&c!==null)return t>=Math.min(o,c)&&t<=Math.max(o,c);let l=a(e[s]);if(l!==null&&u!==null&&d!==null)return l>=Math.min(u,d)&&l<=Math.max(u,d);let g=r(e[s]);if(g!==null&&f!==null&&p!==null)return g>=Math.min(f,p)&&g<=Math.max(f,p);let _=i(e[s]);return _!==null&&m!==null&&h!==null&&_>=Math.min(m,h)&&_<=Math.max(m,h)}}case`in`:case`oneOf`:{let e=Array.isArray(l)?l:[l];return t=>e.some(e=>e===t[s])}case`notIn`:{let e=Array.isArray(l)?l:[l];return t=>!e.some(e=>e===t[s])}default:return()=>!0}}function c(e,t=`AND`){return e.length===0?()=>!0:t===`OR`?t=>e.some(e=>e(t)):t=>e.every(e=>e(t))}function l(e){let t=e.filter(e=>e.field!==`__global__`);if(t.length===0)return()=>!0;let n=t.map(s);return c(n,`AND`)}function u(e){let t=e.filter(e=>e.field!==`__global__`);try{return JSON.stringify(t)}catch{return String(t?.length||0)}}const d={name:`core-filtering`,version:`1.0.0`,dependencies:[`data-pipeline`],install(t,n){let r=e.createLogger({module:`Plugin`,operation:`FilteringPlugin`}),i=n(`data-pipeline`);if(!i){r.warn(`data-pipeline capability not available`);return}let a=[],o=1e4,s=null,c=``,d=null,p=null,m=0,h=null,g=new Map,_=(e,t,n)=>{let r=String(t??``).toLowerCase();return r?n.some(t=>String(e[t]??``).toLowerCase().includes(r)):!0};i.registerDataInterceptor(`filter`,{name:`core-filtering`,type:`filter`,priority:200,enabled:!0,transform:e=>{if(!a.length||!e.length)return e;let n=a.filter(e=>e.enabled!==!1);if(!n.length)return e;try{let r=(t.getData()||[]).length>=o,i=v(n),a=i.some(e=>e.field===`__global__`),s=u(i.filter(e=>e.field!==`__global__`));if(r&&!a)return c===s&&Array.isArray(d)||Array.isArray(d)?d:e}catch{}let r=l(v(n));try{let t=[];for(let i=0;i<e.length;i++){let a=e[i],o=n.filter(e=>e.field===`__global__`),s=!0;if(o.length)for(let e of o){let t=e.metadata?.fields||Object.keys(a);if(!_(a,String(e.value??``),t)){s=!1;break}}s&&r(a)&&t.push(a)}return t}catch{return e}},metadata:{description:`Core filtering functionality with global search support`,version:`1.0.0`}});let v=e=>e.filter(e=>e.enabled!==!1).map(({field:e,operator:t,value:n})=>({field:e,operator:t,value:n})),y=()=>{try{let e=t.getData()||[],n=v(a),i=n.some(e=>e.field===`__global__`),l=n.filter(e=>e.field!==`__global__`),m=u(l);if(e.length<o||l.length===0||i){c=l.length?m:``,d=null,p=null,g.clear();return}if(s||(s=f(),s&&(s.onmessage=e=>{let n=e.data;if(!n)return;let i=g.get(n.id);if(n.id!==p){g.delete(n.id);return}if(n.type===`result`)c=i??``,d=n.data,p=null,g.delete(n.id),t.emit(`data-refresh-requested`,{source:`filter-worker`}),r.info(`Worker filtered ${n.data?.length??0} rows in ${n.duration}ms`);else if(n.type===`progress`)try{t.emit(`filter-progress`,{processed:Number.isFinite(n.processed)?n.processed:0,total:Number.isFinite(n.total)?n.total:0})}catch{}else n.type===`error`&&(g.delete(n.id),p=null,d=null,r.warn(`Filter worker error:`,n.message))})),!s)return;p&&g.delete(p),p=`fw-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,g.set(p,m);let h={id:p,data:e,filters:l};s.postMessage(h)}catch(e){r.warn(`Failed to schedule worker:`,e)}},b=t;b.addFilter=e=>{if(e.field!==`__global__`){let n=(t.getState().columns||[]).find(t=>t.field===e.field);if(n&&n.filterable===!1)return r.warn(`Column '${e.field}' is not filterable`),null}let n={...e,id:`${e.field}_${Date.now()}_${++m}`,enabled:!0};return a.push(n),t.updateConfig({filters:v(a)}),t.emit(`filter-change`,v(a)),y(),n.id},b.removeFilter=e=>{let n=a.findIndex(t=>t.id===e);return n===-1?!1:(a.splice(n,1),t.updateConfig({filters:v(a)}),t.emit(`filter-change`,v(a)),y(),!0)},b.updateFilter=(e,n)=>{let r=a.find(t=>t.id===e);return r?(Object.assign(r,n),t.updateConfig({filters:v(a)}),t.emit(`filter-change`,v(a)),y(),!0):!1},b.clearFilters=()=>{a=[],t.updateConfig({filters:[]}),t.emit(`filter-change`,[]),y()},b.getActiveFilters=()=>[...a],b.toggleFilter=e=>{let n=a.find(t=>t.id===e);return n?(n.enabled=!n.enabled,t.updateConfig({filters:v(a)}),t.emit(`filter-change`,v(a)),y(),n.enabled):!1},b.quickFilter=(e,n)=>{if(a=a.filter(e=>!e.id?.startsWith(`quickfilter_`)),e.trim()){let r=t.getState().columns||[],i=n&&n.length>0?n:r.filter(e=>e.filterable!==!1).map(e=>e.field);if(!i||i.length===0){let e=t.getData();Array.isArray(e)&&e.length>0&&(i=Object.keys(e[0]||{}))}let o={field:`__global__`,operator:`contains`,value:e,id:`quickfilter_global`,enabled:!0,metadata:{fields:i,isGlobalSearch:!0}};a.push(o)}t.updateConfig({filters:v(a)}),t.emit(`filter-change`,v(a)),y()},typeof t.on==`function`&&(h=t.on(`config-changed`,e=>{let n=Array.isArray(e.filters)?e.filters:[],r=v(a);if(JSON.stringify(n)===JSON.stringify(r)){y();return}a=n.map(e=>({...e,id:`${e.field}_${Date.now()}_${++m}`,enabled:!0})),t.emit(`filter-change`,v(a)),y()}),t.on(`data-changed`,()=>y()),t.on(`filter-cancel`,()=>{try{s&&s.terminate()}catch{}s=null,p=null,d=null,g.clear(),r.info(`Filter worker canceled by user`)})),b._filteringPluginCleanup=()=>{if(i.removeDataInterceptor(`filter`,`core-filtering`),h){try{h()}catch{}h=null}},r.info(`Core filtering functionality installed with enhanced data pipeline`)},cleanup(){e.createLogger({module:`Plugin`,operation:`FilteringPlugin`}).info(`Cleaned up`)}};function f(){try{return new Worker(new URL(`/assets/filter-worker-DY5_Qt7p.js`,``+{}.url),{type:`module`})}catch{return null}}Object.defineProperty(exports,`filteringPlugin`,{enumerable:!0,get:function(){return d}});
//# sourceMappingURL=filtering-plugin-CR1F2Smm.cjs.map