const e=require(`./logger-DYZU5RTs.cjs`),t=150,n=50,r=500;var i=(e,t,n)=>Math.min(n,Math.max(t,e));function a(e,t,n={}){if(!t.length){e.order=n.resetOrder?[]:e.order;return}let r=t.map(e=>e.id),a=new Set(r);if(n.resetOrder||e.order.length===0)e.order=[...r];else{let t=e.order.filter(e=>a.has(e)),n=r.filter(e=>!t.includes(e));e.order=[...t,...n]}let o=e=>{for(let t of Array.from(e.keys()))a.has(t)||e.delete(t)};o(e.widths),o(e.visibility),o(e.pinned),t.forEach(t=>{let n=t.minWidth??50,r=t.maxWidth??500,a=e.widths.get(t.id),o=t.width,s=o??150,c=typeof a==`number`&&typeof o==`number`&&Math.abs(o-a)>=.5&&e.activeResize?.columnId!==t.id?o:a,l=i(c??s,n,r);if(e.widths.set(t.id,l),!e.visibility.has(t.id)){let n=t.visible!==!1;e.visibility.set(t.id,n)}e.pinned.has(t.id)||e.pinned.set(t.id,t.pinned??null)})}function o(e,t){let n=new Map(t.map(e=>[e.id,e]));return a(e,t),e.order.map(e=>n.get(e)).filter(t=>typeof t==`object`&&!!t&&`id`in t&&e.visibility.get(t.id)!==!1).map(t=>{let n=t.minWidth??50,r=t.maxWidth??500,a=e.widths.get(t.id)??t.width??150,o=i(a,n,r);o!==a&&e.widths.set(t.id,o);let s=e.pinned.get(t.id)??t.pinned??null;return{...t,width:o,pinned:s||void 0}})}function s(e,t){let n=null,r=null,a=!1,o=(i=!1)=>{n!==null&&(window.cancelAnimationFrame(n),n=null);let a=t.activeResize;if(!a)return;let o=r??(i?a.lastWidth:null);r=null,o!=null&&e.resizeColumn?.(a.columnId,o)},s=()=>{a&&=(window.removeEventListener(`mousemove`,d),window.removeEventListener(`mouseup`,f),window.removeEventListener(`blur`,p),!1)},c=()=>{n!==null&&(window.cancelAnimationFrame(n),n=null),t.activeResize=null,r=null,s()},l=(e=!1)=>{o(e),c()},u=e=>{r=e,n===null&&(n=window.requestAnimationFrame(()=>{n=null,o()}))};function d(e){let n=t.activeResize;if(!n)return;let r=e.clientX-n.startX,a=n.edge===`left`?-r:r,o=i(n.startWidth+a,n.minWidth,n.maxWidth);Math.abs(o-n.lastWidth)<.5||(n.lastWidth=o,u(o))}let f=()=>{l(!0)},p=()=>{l(!0)};return{handleResizeStart:n=>{if(!n)return;let{columnId:r,startX:o,currentWidth:s}=n;t.activeResize&&l(!0);let c=(e.getState().columns||[]).find(e=>e.id===r);if(!c||c.resizable===!1)return;let u=c.minWidth??50,m=c.maxWidth??500,h=t.widths.get(r)??c.width??s??150,g=(t.pinned.get(r)??c.pinned??null)===`right`?`left`:`right`;t.activeResize={columnId:r,startX:o,startWidth:i(h,u,m),minWidth:u,maxWidth:m,lastWidth:i(h,u,m),edge:g},a||=(window.addEventListener(`mousemove`,d),window.addEventListener(`mouseup`,f),window.addEventListener(`blur`,p),!0)},cleanup:()=>{l(!0)}}}const c={name:`core-column-management`,version:`1.0.0`,dependencies:[],install(t,n){let r=e.createLogger({module:`Plugin`,operation:`ColumnManagementPlugin`}),c={order:[],widths:new Map,visibility:new Map,pinned:new Map,activeResize:null},l=(e={})=>{let n=t.getState().columns||[];a(c,n,e)},u=()=>{let e=t.getState().columns||[];return o(c,e)},d=t,f=[],p=s(d,c);d.moveColumn=(e,n)=>{let r=c.order.indexOf(e);if(r===-1)return!1;c.order.splice(r,1);let i=Math.max(0,Math.min(n,c.order.length));c.order.splice(i,0,e);let a=u();return t.setColumns(a),t.emit(`column-move`,{fromIndex:r,toIndex:i}),!0},d.swapColumns=(e,n)=>{let r=c.order.indexOf(e),i=c.order.indexOf(n);if(r===-1||i===-1)return!1;c.order[r]=n,c.order[i]=e;let a=u();return t.setColumns(a),t.emit(`column-swap`,{index1:r,index2:i}),!0},d.resizeColumn=(e,n)=>{let r=(t.getState().columns||[]).find(t=>t.id===e),a=r?.minWidth??50,o=r?.maxWidth??500,s=c.widths.get(e)??r?.width??150,l=i(n,a,o);if(Math.abs(l-s)<.5)return!1;c.widths.set(e,l);let d=t.updateColumn?.bind(t);if(typeof d==`function`)d(e,{width:l});else{let e=u();t.setColumns(e)}return t.emit(`column-resize`,{columnId:e,width:l}),!0},d.autoSizeColumn=e=>{let n=t.getState().data||[],r=t.getState().columns?.find(t=>t.id===e);if(!r)return!1;let i=Math.max(r.title?.length||0,...n.map(e=>String(e[r.field]||``).length)),a=Math.max(80,Math.min(300,i*8));return d.resizeColumn?.(e,a)??!1},d.hideColumn=e=>{if(c.visibility.get(e)===!1)return!1;c.visibility.set(e,!1);let n=u();return t.setColumns(n),t.emit(`column-hide`,{columnId:e}),!0},d.showColumn=e=>{if(c.visibility.get(e)!==!1)return!1;c.visibility.set(e,!0);let n=u();return t.setColumns(n),t.emit(`column-show`,{columnId:e}),!0},d.toggleColumnVisibility=e=>c.visibility.get(e)===!1?d.showColumn?.(e)??!1:d.hideColumn?.(e)??!1,d.getHiddenColumns=()=>Array.from(c.visibility.entries()).filter(([,e])=>!e).map(([e])=>e),d.pinColumn=(e,n)=>{if(c.pinned.set(e,n),n===`left`){let t=c.order.indexOf(e);t>-1&&(c.order.splice(t,1),c.order.unshift(e))}else{let t=c.order.indexOf(e);t>-1&&(c.order.splice(t,1),c.order.push(e))}let r=u();return t.setColumns(r),t.emit(`column-pin`,{columnId:e,side:n}),!0},d.unpinColumn=e=>{c.pinned.set(e,null);let n=u();return t.setColumns(n),t.emit(`column-unpin`,{columnId:e}),!0},d.getPinnedColumns=()=>{let e=[],t=[];return c.pinned.forEach((n,r)=>{n===`left`?e.push(r):n===`right`&&t.push(r)}),{left:e,right:t}},d.setColumnOrder=e=>{let n=t.getState().columns||[],r=new Set(n.map(e=>e.id));if(!e.every(e=>r.has(e)))return!1;let i=[...c.order];c.order=[...e];let a=u();return t.setColumns(a),t.emit(`column-order-change`,{oldOrder:i,newOrder:e}),!0},d.resetColumns=()=>{c.order=[],c.widths.clear(),c.visibility.clear(),c.pinned.clear(),l({resetOrder:!0});let e=u();return t.setColumns(e),t.emit(`columns-reset`,{columns:e}),!0},d.getColumnState=()=>({order:[...c.order],widths:new Map(c.widths),visibility:new Map(c.visibility),pinned:new Map(c.pinned)}),d.setColumnState=e=>{e.order&&(c.order=[...e.order]),e.widths&&(c.widths=new Map(e.widths)),e.visibility&&(c.visibility=new Map(e.visibility)),e.pinned&&(c.pinned=new Map(e.pinned));let n=u();return t.setColumns(n),t.emit(`column-state-change`,{state:d.getColumnState?.()}),!0},l({resetOrder:!0});function m(e){if(!Array.isArray(e))return;a(c,e);let n=u();n.length!==e.length&&t.setColumns(n)}if(typeof t.on==`function`){let e=t.on(`columns-changed`,m);f.push(e);let n=t.on(`column-updated`,e=>{if(!e)return;let{columnId:n,updates:r}=e;if(!(!n||typeof r!=`object`||!r)){if(typeof r.width==`number`){let e=(t.getState().columns||[]).find(e=>e.id===n),a=e?.minWidth??50,o=e?.maxWidth??500,s=i(r.width,a,o);c.widths.set(n,s)}if(Object.prototype.hasOwnProperty.call(r,`pinned`)){let e=r.pinned;e===`left`||e===`right`?c.pinned.set(n,e):e??c.pinned.set(n,null)}}});f.push(n);let a=t.on(`column-sort`,e=>{if(!e)return;let{columnId:n,field:i,ctrlKey:a}=e,o=(t.getState().columns||[]).find(e=>e.id===n||e.field===i);if(!o){r.debug(`column-sort event ignored: column not found`,{columnId:n,field:i});return}if(o.sortable===!1){r.debug(`column-sort event ignored: column not sortable`,{columnId:n,field:i});return}let s=o.field||i;if(!s){r.warn(`column-sort event missing field information`,{columnId:n,field:i});return}let c=typeof d.sortByColumn==`function`?d.sortByColumn.bind(d):null,l=typeof d.addSortField==`function`?d.addSortField.bind(d):null;if(a&&l){l(s),r.debug(`column-sort event applied via multi-sort`,{columnId:n,field:s,ctrlKey:a});return}c?(c(s),r.debug(`column-sort event applied via primary sort`,{columnId:n,field:s,ctrlKey:a})):l?(l(s),r.debug(`column-sort event fallback to addSortField`,{columnId:n,field:s,ctrlKey:a})):r.warn(`column-sort event ignored: sorting capability unavailable`,{columnId:n,field:s})});f.push(a);let o=t.on(`column-resize-start`,e=>{p.handleResizeStart(e)});f.push(o)}t.registerMemoryCleanup?.(()=>{f.forEach(e=>{e()}),f.length=0,p.cleanup(),c.activeResize=null}),r.info(`Column management functionality installed`,{features:[`reorder`,`resize`,`visibility`,`pinning`,`sorting`,`state persistence`]})}};Object.defineProperty(exports,`DEFAULT_COLUMN_WIDTH`,{enumerable:!0,get:function(){return 150}}),Object.defineProperty(exports,`DEFAULT_MAX_COLUMN_WIDTH`,{enumerable:!0,get:function(){return 500}}),Object.defineProperty(exports,`DEFAULT_MIN_COLUMN_WIDTH`,{enumerable:!0,get:function(){return 50}}),Object.defineProperty(exports,`columnManagementPlugin`,{enumerable:!0,get:function(){return c}});
//# sourceMappingURL=column-management-plugin-BXQSSUQ_.cjs.map